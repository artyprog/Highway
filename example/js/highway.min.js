!function(){function t(){var t=this,e=document.querySelectorAll("[highway-view]");if(t.loadInlineTemplates(),!e||0===e.length)return void console.log("HighwayJS - No highway-view element found");if(e.length>1)return void console.log("HighwayJS - There should only be one highway-view element");t.container=e[0],t.templateCache=[],t.states=[];var o=function(e){t.navigateToUrl(e)};window.addEventListener("hashchange",o)}this.container=null,this.routes=null,this.defaultState=null,this.currentState=null,this.templateCache=null,this.baseUrl=null,this.states=null,this.inlineTemplates=null,t.prototype.loadInlineTemplates=function(){self.inlineTemplates=[];for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var o=t[e],a=o.getAttribute("id"),n=o.getAttribute("type");if(a&&n&&"text/html"===n.toLowerCase()){var i=o.innerHTML;self.inlineTemplates.push({id:a,template:i})}}},t.prototype.navigateToUrl=function(t){var e=this,o=e.getStateFromUrl();e.navigateTo(o)},t.prototype.getStateFromUrl=function(){var t=this,e=window.location.href;if(-1===e.indexOf("#"))return null;var o=e.substr(e.indexOf("#")+1);return t.stateExists(o)?o:null},t.prototype.navigateToPrevious=function(t){var e=this;e.states.length>0&&(e.states.pop(),e.navigateTo(e.states[e.states.length-1]))},t.prototype.configureRoutes=function(t){var e=this;if(!t||t&&!t.routes)throw"HighwayJS - No routes defined";if(!t["default"])throw"HighwayJS - Please specify a default route";e.routes=t.routes,e.defaultState=t["default"];var o=e.getStateFromUrl();e.navigateTo(o,function(){e.cacheAllRoutes()})},t.prototype.navigateTo=function(t,e){var o=this;if(o.currentState!==t){if(!t)return void o.navigateTo(o.defaultState,e);if(!o.routes)return void console.log("HighwayJS - No routes configured");for(var a,n=0;n<o.routes.length;n++){var i=o.routes[n];if(i.state===t){a=i;break}}return a?void o.loadRoute(a,function(t){o.destroyRoute(),o.container.innerHTML=t.template,o.states.push(a.state),o.currentState=a.state,o.container.children&&o.container.children.length>0&&(o.container.children.length>1&&console.log("HighwayJS - Template should have only one root object"),a.viewmodel&&a.viewmodel.init&&a.viewmodel.init(o.container.firstChild)),e&&e()}):void o.navigateTo(o.defaultState,e)}},t.prototype.destroyRoute=function(){for(var t=this;t.container.firstChild;)t.container.removeChild(t.container.firstChild);if(t.currentState){for(var e,o=0;o<t.routes.length;o++){var a=t.routes[o];if(a.state===t.currentState){e=a;break}}e&&e.viewmodel&&e.viewmodel.destroy&&e.viewmodel.destroy()}},t.prototype.stateExists=function(t){for(var e=this,o=0;o<e.routes.length;o++){var a=e.routes[o];if(a.state===t)return!0}return!1},t.prototype.loadRoute=function(t,e){for(var o,a=this,n=0;n<a.templateCache.length;n++){var i=a.templateCache[n];if(i.state===t.state){o=i;break}}return o?void(e&&e(o)):t.template?void a.loadTemplate(t.template,function(o){var n={state:t.state,template:o,viewmodel:t.viewmodel};a.templateCache.push(n),e&&e(n)}):void console.log('HighwayJS - No template specified for "'+t.state+'"')},t.prototype.cacheAllRoutes=function(){for(var t=this,e=0;e<t.routes.length;e++){var o=t.routes[e];t.loadRoute(o)}},t.prototype.loadTemplate=function(t,e){if(0===t.indexOf("#")){for(var o=t.substr(1),a=0;a<self.inlineTemplates.length;a++){var n=self.inlineTemplates[a];if(n.id===o)return void e(n.template)}throw'HighwayJS - Could not find template "'+t+'"'}var i=new XMLHttpRequest;i.onreadystatechange=function(){return 4==i.readyState&&200==i.status?void(e&&e(i.responseText)):void 0},i.open("GET",t,!0),i.send()},highway=window.highway=new t}();var highway;
